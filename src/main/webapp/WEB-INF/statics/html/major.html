<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>admin-ç®¡ç†ä¸“ä¸šé¡µé¢</title>

</head>
<link rel="stylesheet" href="../../bootstrap-3.3.7-dist/css/bootstrap.min.css">
<link rel="stylesheet" href="../../plugin/layui/css/layui.css">
<link rel="stylesheet" type="text/css" href="../../plugin/font/iconfont.css">
<link rel="stylesheet" href="../../css/all.css">
<body>
<!--<button class="layui-btn layui-btn-sm" id="search-btn">æŸ¥è¯¢</button>-->
<script type="text/javascript" src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
<script src="https://cdn.longdeshui.com.cn/dic.js"></script>
<script src="https://cdn.longdeshui.com.cn/resumedic.js"></script>
<script type="text/javascript" src="../../plugin/layui/layui.all.js"></script>
<script type="text/javascript">
    $(function all() {
        // reloadall();
    });

    // function reloadall() {
    //     //è¯·æ±‚å‚æ•°
    //     var list = {};
    //
    //     $.ajax({
    //         //è¯·æ±‚æ–¹å¼
    //         type: "get",
    //         //è¯·æ±‚çš„åª’ä½“ç±»å‹
    //         contentType: "application/json;charset=UTF-8",
    //         //è¯·æ±‚åœ°å€
    //         url: "/major/findAllWithUserJob",
    //         //æ•°æ®ï¼Œjsonå­—ç¬¦ä¸²
    //         //data : JSON.stringify(list),
    //         //è¯·æ±‚æˆåŠŸ
    //         success: function (result) {
    //             console.log(result);
    //             var html = "";
    //             //è¦†ç›–ä¹‹å‰çš„è¡¨
    //             document.getElementById("userTable").innerHTML = "<h3>" + 'æ€»å…±æœç´¢åˆ°' + result.length + 'æ¡ä¸“ä¸šè¯å…¸ä¿¡æ¯:' + "</h3>";
    //             html += "<table border=1>";
    //             html += "<tr><td>ç¼–å·</td><td>ä¸“ä¸šåç§°</td><td>åŒ…å«çš„æ–‡å­—</td><td>æ“ä½œ</td></tr>";
    //             for (var i = 0; i < result.length; i++) {
    //                 var obj = result[i];
    //                 html += "<tr><td>" + obj.jobId + "</td><td>" + obj.job + "</td><td>" + obj.jobContain + "</td>" + '<td><input id="up" type="button" value="ç¼–è¾‘" onclick=update("'
    //                     + obj.jobId
    //                     + '")>'
    //                     + '<input type="button" value="åˆ é™¤"  onclick=del("'
    //                     + obj.jobId + '")></td>'
    //                     + "</tr>";
    //             }
    //             html += "</table>";
    //             $("#userTable").append(html);
    //         }, error: function (e) {
    //             console.log(e.status);
    //             console.log(e.responseText);
    //         }
    //     });
    // }

    layui.use(['element', 'layer', 'jquery', 'table'], function () {
        $(function all() {
            getTableList();
        });
        $('body').on('click', '#search-btn', function () {
            getTableList();
        });


        // å¯¼å‡ºexcelè¡¨ç‚¹å‡»äº‹ä»¶
        $("#export").click(function () {
            var options = getWhereData()
            options.page = $('.layui-laypage-skip .layui-input').val()
            options.limit = $('.layui-laypage-limits>select').val()
            var url = '${base}/es/export?';
            url = url + excelUrl(options);
            window.open(url);
        });

        //åˆå§‹åŒ–è¡¨æ ¼
        function getTableList() {
            // var d = query();
            // alert(d);
            layui.table.render({
                elem: '#companyListTable',
                id: 'idTest',
                url: '/major/findPageByUserMajor',
                toolbar: '#toolbarDemo',
                cols: [[
                    /* {checkbox: true, fixed: true}, */
                    {field: 'majorId', title: 'ä¸“ä¸šç¼–å·', fixed: 'left', width: 300},
                    {field: 'major', title: 'ä¸“ä¸š', fixed: 'left', width: 200},
                    {field: 'majorContain', title: 'ä¸“ä¸šåŒ…å«çš„å­—ç¬¦', fixed: 'left', width: 200},
                    {field: 'updatedDate', title: 'è¯å…¸æ›´æ–°æ—¶é—´', width: 300},
                    {
                        fixed: 'right', title: 'æ“ä½œ', width: 110,
                        templet: function (d) {
                            return '<a class="layui-btn layui-btn-xs layui-btn-xs" lay-event="edit">ç¼–è¾‘</a>' +
                                '<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">åˆ é™¤</a>'
                        }
                    }
                ]],
                limits: [10, 50, 100, 200, 300, 500],
                limit: 10,
                page: true,
                // data: [d],
                // even: true,
                method: 'post'
                // done: function (res, curr, count) {
                // }

            });
        }

    });
    //  ç›‘å¬è¡Œå·¥å…·äº‹ä»¶
    layui.table.on('tool(companyListTableDemo)', function (obj) { //æ³¨ï¼štool æ˜¯å·¥å…·æ¡äº‹ä»¶åï¼Œtest æ˜¯ table åŸå§‹å®¹å™¨çš„å±æ€§ lay-filter="å¯¹åº”çš„å€¼"
        var data = obj.data, //è·å¾—å½“å‰è¡Œæ•°æ®
            layEvent = obj.event; //è·å¾— lay-event å¯¹åº”çš„å€¼
        switch (layEvent) {
            case 'edit':
                update(data.majorId);
                break;
            case 'del':
                del(data.majorId);
                break;
        }
    });



    function insert() {
        var major = $("#job").val();
        var majorContain = $("#jobContain").val();
        if (major == "" && majorContain == "") {
            alert("ä¸“ä¸šåç§°æˆ–è€…åŒ…å«çš„å­—ç¬¦ä¸²ä¸èƒ½ä¸ºç©º");
            return;
        }
        if (confirm("ç¡®å®šè¦æ·»åŠ ä¸“ä¸šè¯å…¸ä¿¡æ¯å—ï¼Ÿ")) {
            $.ajax({
                type: "post",
                contentType: "application/json;charset=UTF-8",
                url: "/major/insertUserMajor",
                data: JSON.stringify({
                    major: major,
                    majorContain: majorContain
                }),
                success: function (result) {
                    console.log(result);
                    alert(result);
                    location.reload(true);
                    // reloadall();
                }, error: function (e) {
                    console.log(e.status);
                    console.log(e.responseText);
                }
            });
        } else {
            alert("æ‚¨å–æ¶ˆäº†æ·»åŠ æ“ä½œ!ğŸ‰");
        }

    }

    function del(majorId) {
        if (majorId == undefined) {
            majorId = $("#update_id").val();
            if (majorId == "") {
                alert("è¾“å…¥ä¸èƒ½ä¸ºç©º!");
                return;
            }
        }

        if (confirm("ç¡®å®šè¦åˆ é™¤ç¼–å·ä¸º" + majorId + "çš„ä¸“ä¸šè¯å…¸ä¿¡æ¯å—ï¼Ÿ")) {
            $.ajax({
                type: "post",
                contentType: "application/json;charset=UTF-8",
                url: "/major/deleteUserMajor",
                data: JSON.stringify({
                    majorId: majorId,
                    major: null
                }),
                success: function (result) {
                    console.log(result);
                    alert(result);
                    location.reload(true);
                }, error: function (e) {
                    console.log(e.status);
                    console.log(e.responseText);
                }
            });
        } else {
            alert("æ‚¨å–æ¶ˆäº†åˆ é™¤æ“ä½œ!ğŸ‰");
        }

    }

    function update(majorId) {
        if (majorId == undefined) {
            majorId = $("#update_id").val();
            if (majorId == "") {
                alert("ç¼–å·ä¸èƒ½ä¸ºç©º");
                return;
            }
        }
        var major = prompt('ä¿®æ”¹ç¼–å·ä¸º"' + majorId + '"çš„ä¸“ä¸šåç§°ä¸º:');
        if (major) {
            var majorContain = prompt('ä¿®æ”¹"' + major + '"çš„åŒ…å«çš„å­—ç¬¦ä¸º:');
            if (majorContain) {
                $.ajax({
                    type: "post",
                    contentType: "application/json;charset=UTF-8",
                    url: "/major/updateUserMajor",
                    data: JSON.stringify({
                        majorId: majorId,
                        major: major,
                        majorContain: majorContain
                    }), success: function (result) {
                        debugger;
                        console.log(result);
                        alert(result);
                        location.reload(true);
                    }, error: function (e) {
                        console.log(e.status);
                        console.log(e.responseText);
                    }
                });
            } else {
                alert("æ‚¨å–æ¶ˆäº†æ›´æ–°æ“ä½œ!ğŸ‰");
            }
        } else {
            alert("æ‚¨å–æ¶ˆäº†æ›´æ–°æ“ä½œ!ğŸ‰");
        }
    }
</script>
<br/>
<div>
    <input type="text" id="update_id" placeholder="è¾“å…¥è¯å…¸ç¼–å·" minlength="2">
    <input type="text" id="job" placeholder="è¾“å…¥ä¸“ä¸šè¯å…¸åç§°" minlength="2">
    <input type="text" id="jobContain" placeholder="è¾“å…¥è¯¥ä¸“ä¸šåŒ…å«çš„å­—ç¬¦" minlength="2">
    <button style="width: 100px;
            height: 25px;
            background-color: #68b86c;
            border: none;
            border-radius: 6px;
            color: #fff;
            margin-left: 1cm;
            text-align: center" onclick="insert()">æ·»åŠ ä¸“ä¸šè¯å…¸
    </button>
    <button style="width: 100px;
            height: 25px;
            background-color: #68b86c;
            border: none;
            border-radius: 6px;
            color: #fff;
            margin-left: 1cm;
            text-align: center" onclick="update()">ä¿®æ”¹ä¸“ä¸šè¯å…¸
    </button>
    <button style="width: 100px;
            height: 25px;
            background-color: sandybrown;
            border: none;
            border-radius: 6px;
            color: #fff;
            margin-left: 1cm;
            text-align: center" onclick="del()">åˆ é™¤
    </button>
</div>
<hr>
<table class="layui-table" id="companyListTable" lay-filter="companyListTableDemo" lay-data="{id: 'idTest'}"></table>
</body>
</html>